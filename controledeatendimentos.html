<!-- controledeatendimentos.html -->
<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Atendimentos - Wisdom ARK</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <!-- CSS externo -->
  <link href="controleatdm.css" rel="stylesheet" />
</head>

<body>
  <aside class="sidebar">
    <h4><i class="fas fa-stethoscope"></i> Wisdom ARK</h4>
    <a href="index.html"><i class="fas fa-home"></i> Início</a>
    <a href="agendadeconsultas.html"><i class="fas fa-calendar-check"></i> Agendar Consultas</a>
    <a href="#" class="active"><i class="fas fa-notes-medical"></i> Controle de Atendimentos</a>
  </aside>

  <main class="main-content">
    <h2><i class="fas fa-notes-medical"></i> Controle de Atendimentos</h2>
    <table>
      <thead>
        <tr>
          <th>Paciente</th>
          <th>Data</th>
          <th>Hora</th>
          <th>Situação</th>
          <th>Consultório</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tabela-atendimentos"></tbody>
    </table>
  </main>
<!--
  <footer>&copy; 2025 Wisdom ARK - Todos os direitos reservados</footer>
-->
  <script>
    function carregarTabela() {
      const tbody = document.getElementById('tabela-atendimentos');
      tbody.innerHTML = '';
      const dados = JSON.parse(localStorage.getItem('consultas') || '[]');

      dados.forEach((evento, index) => {
        const dataObj = new Date(evento.start);
        const dataFormatada = dataObj.toLocaleDateString('pt-BR');
        const horaFormatada = dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        let corClasse = '';
        const situacao = evento.severity || evento.situacao || '-';

        if (situacao === 'Leve') corClasse = 'text-success fw-bold';
        else if (situacao === 'Moderado') corClasse = 'text-warning fw-bold';
        else if (situacao === 'Grave') corClasse = 'text-danger fw-bold';
        else if (situacao === 'Atendido com Sucesso') corClasse = 'text-primary fw-bold';

        const consultorio = evento.consultorio || '-';

        const linha = document.createElement('tr');
        linha.innerHTML = `
          <td>${evento.patient || evento.title}</td>
          <td>${dataFormatada}</td>
          <td>${horaFormatada}</td>
          <td class="${corClasse}">${situacao}</td>
          <td>${consultorio}</td>
          <td>
            <button class="btn btn-sm btn-success me-2" title="Atendido com Sucesso" onclick="marcarComoAtendido(${index})">
              <i class="fas fa-check"></i>
            </button>
            <button class="btn btn-sm btn-danger" title="Excluir" onclick="removerConsulta(${index})">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(linha);
      });
    }

    function removerConsulta(index) {
      let eventos = JSON.parse(localStorage.getItem('consultas') || '[]');
      eventos.splice(index, 1);
      localStorage.setItem('consultas', JSON.stringify(eventos));
      carregarTabela();
    }

    function marcarComoAtendido(index) {
      let eventos = JSON.parse(localStorage.getItem('consultas') || '[]');
      eventos[index].severity = 'Atendido com Sucesso';
      localStorage.setItem('consultas', JSON.stringify(eventos));
      carregarTabela();
    }

    window.addEventListener('DOMContentLoaded', carregarTabela);
  </script>
</body>

</html>